<extend name="Public/common" />
<block name="main">
        <div class="page-title">{:(isset($detail['id'])?'修改商品':'添加商品')}</div>
        <div class="layui-field-box" style="width: 700px">
            <form class="layui-form" action="" method="post">
                <if condition="isset($detail['id'])">
                    <input type="hidden" name="id" value="{$detail['id']}">
                </if>
                <input type="hidden" name="merchant_id" value="{$detail['merchant_id']}">

                <div class="layui-form-item" id="pack-type">
                    <label class="layui-form-label"><span style="color: #f00">*</span>商品类型</label>
                    <div class="layui-input-block pack-type">
                        <input type="radio" name="type" value="1" title="优惠套餐">
                        <input type="radio" name="type" value="2" title="卡座套餐">
                        <input type="radio" name="type" value="3" title="单品酒水">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">商品名称</label>
                    <div class="layui-input-block">
                        <input type="text" name="title" required value="{$detail['title']}" lay-verify="required" class="layui-input">
                    </div>
                </div>

                <div class="layui-upload">
                    <label class="layui-form-label">商品图片</label>
                    <div class="layui-input-block">
                        <input type="text" class="layui-input" name="image" value="{$detail['image']}"  id="ad_img" style="display: inline-block;width: 400px;" />
                        <button type="button" class="layui-btn" id="upimg" style="display: inline-block">选择图片</button>
                        <div id="reupload" style="display: inline-block"></div>
                        <div class="layui-upload-list">
                            <img class="upload_img" src="<notempty name="detail.image">{$attachment_url}{$detail['image']}</notempty>" style="max-height:100px;"/>
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">售价</label>
                    <div class="layui-input-inline">
                        <input type="text" name="price" required value="{$detail['price']?$detail['price']:0}" lay-verify="required|money" class="layui-input" >
                    </div>
                    <div class="layui-input-inline">
                        <div class="layui-form-mid layui-word-aux">本商品线上销售价格</div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">参考价格</label>
                    <div class="layui-input-inline">
                        <input type="text" name="market_price" required value="{$detail['market_price']?$detail['market_price']:0}" lay-verify="required|money" class="layui-input" >
                    </div>
                    <div class="layui-input-inline">
                        <div class="layui-form-mid layui-word-aux">商品市场销售价格</div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">销售库存</label>
                    <div class="layui-input-inline">
                        <input type="text" name="stock" required value="{$detail['stock']?$detail['stock']:0}" lay-verify="required|number" class="layui-input" >
                    </div>
                    <div class="layui-input-inline">
                        <div class="layui-form-mid layui-word-aux">商品销售数量</div>
                    </div>
                </div>

                <div class="layui-form-item layui-form-text" id="description">
                    <label class="layui-form-label">商品描述</label>
                    <div class="layui-input-block">
                        <textarea placeholder="请填写商品描述" name="description" required lay-verify="required" class="layui-textarea">{$detail['description']}</textarea>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">商品状态</label>
                    <div class="layui-input-block pack-status">
                        <input type="radio" name="status" value="0" title="下架">
                        <input type="radio" name="status" value="1" title="上架">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">限制购买数量</label>
                    <div class="layui-input-inline">
                        <input type="text" name="limit_buy" required value="{$detail['limit_buy']?$detail['limit_buy']:0}" lay-verify="number" class="layui-input" >
                    </div>
                    <div class="layui-input-inline">
                        <div class="layui-form-mid layui-word-aux">每单购买该商品的数量</div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn" lay-submit lay-filter="admin-form">立即提交</button>
                        <a  href="{:U('index',['merchant_id' => $detail['merchant_id']])}" class="layui-btn layui-btn-danger">返回列表</a>
                    </div>
                </div>
            </form>
        </div>
</block>
<block name="myScript">
    <script type="text/javascript">
        $(function () {
            //设置生日特权值
            $('.pack-type input').val([{$detail['type']|default=1}]);
            //设置免预定金值
            $('.pack-status input').val([{$detail['status']|default=0}]);

            layui.use(['form','upload', 'laydate'], function(){
                var form = layui.form,
                    layer = layui.layer,
                    upload = layui.upload,
                    laydate = layui.laydate;

                //普通图片上传
                var uploadInst = upload.render({
                    elem: '#upimg'
                    ,url: "{:U('Upload/index', ['mold' => 'goods'])}"
                    ,done: function(res){
                        if (res.code != 0){
                            return layer.msg(res.msg);
                        }
                        //显示上传成功的图片
                        $('#ad_img').val(res.data.src);
                        $('.upload_img').prop('src','{$attachment_url}'+res.data.src);

                    }
                    ,error: function(){
                        //演示失败状态，并实现重传
                        var demoText = $('#reupload');
                        demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-mini demo-reload">重试</a>');
                        demoText.find('.demo-reload').on('click', function(){
                            uploadInst.upload();
                        });
                    }
                });

                form.verify({
                    money: [/^[0-9]+(\.[0-9]{1,2})?$/, '金额填写不正确']
                });

                //显示隐藏生日文本框
                //var value = $('#birthday .layui-form-radio').prev('input').val();
                var value = $('#birthday input:checked').val();
                if (value == 1){
                    $('#birthday_content_box').show();
                }else {
                    $('#birthday_content_box').hide();
                }


                $('#birthday .layui-form-radio').click(function () {
                    var value = $(this).prev('input').val();
                    if (value == 1){
                        $('#birthday_content_box').show();
                    }else {
                        $('#birthday_content_box').hide();
                    }
                });

                //时间选择器
                laydate.render({
                    elem: '#start_time'
                    ,type: 'datetime'
                    ,format: 'yyyy-MM-dd HH:mm:ss'
                });

                laydate.render({
                    elem: '#end_time'
                    ,type: 'datetime'
                    ,format: 'yyyy-MM-dd HH:mm:ss'
                });
            });
        })
    </script>
    <script>
        $(function () {

        })
    </script>
</block>